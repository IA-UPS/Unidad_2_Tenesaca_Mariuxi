<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Edmond Geraud - Mariuxi Tenesaca">

<title>Repaso:Predicción de la diabetes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="repaso_files/libs/clipboard/clipboard.min.js"></script>
<script src="repaso_files/libs/quarto-html/quarto.js"></script>
<script src="repaso_files/libs/quarto-html/popper.min.js"></script>
<script src="repaso_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="repaso_files/libs/quarto-html/anchor.min.js"></script>
<link href="repaso_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="repaso_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="repaso_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="repaso_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="repaso_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Repaso:Predicción de la diabetes</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Edmond Geraud - Mariuxi Tenesaca </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="nota" class="level2">
<h2 class="anchored" data-anchor-id="nota"><strong>Nota:</strong></h2>
<p><strong><em>Los comentarios agregados se encuentran en cursiva y negrita para evidenciar los mismos.</em></strong></p>
</section>
<section id="intro" class="level1">
<h1>Intro</h1>
<p>Este sería un ejemplo de examen El siguiente conjunto de datos, consuste en predecir a pacientes basandonos en datos clínicos, si puede padecer diabetes o no.</p>
<p>Antes de cualquier método de clasificación, regresión o lo que sea, necesitamos explorar los datos.</p>
<p>Esto supone exámenes estadísticos inferenciales univariantes, bivariantes y multivariantes.</p>
<p><strong><em>El análisis univariado: Examinará las características individuales de los datos clínicos.</em></strong></p>
<p><strong><em>El análisis bivariado: Ayudará a comprender la relación entre las diferentes características y la variable objetivo.</em></strong></p>
<p><strong><em>El análisis multivariante: Permitirá considerar simultáneamente varias características y evaluar su impacto en la predicción de la diabetes.</em></strong></p>
<p><strong><em>Estos análisis permiten tener una comprensión más profunda de los datos y su relación con la variable de interés.</em></strong></p>
</section>
<section id="pima-indians-diabetes-database" class="level1">
<h1>Pima Indians Diabetes Database</h1>
<p>This dataset is originally from the National Institute of Diabetes and Digestive and Kidney Diseases. The objective of the dataset is to diagnostically predict whether or not a patient has diabetes, based on certain diagnostic measurements included in the dataset. Several constraints were placed on the selection of these instances from a larger database. In particular, all patients here are females at least 21 years old of Pima Indian heritage.</p>
</section>
<section id="cargamos-librerias" class="level1">
<h1>Cargamos librerias</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lattice</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggstatsplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>You can cite this package as:
     Patil, I. (2021). Visualizations with statistical details: The 'ggstatsplot' approach.
     Journal of Open Source Software, 6(61), 3167, doi:10.21105/joss.03167</code></pre>
</div>
</div>
</section>
<section id="cargamos-los-datos" class="level1">
<h1>Cargamos los datos</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./datos/diabetes.csv"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(datos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Pregnancies Glucose BloodPressure SkinThickness Insulin  BMI
1           6     148            72            35       0 33.6
2           1      85            66            29       0 26.6
3           8     183            64             0       0 23.3
4           1      89            66            23      94 28.1
5           0     137            40            35     168 43.1
6           5     116            74             0       0 25.6
  DiabetesPedigreeFunction Age Outcome
1                    0.627  50       1
2                    0.351  31       0
3                    0.672  32       1
4                    0.167  21       0
5                    2.288  33       1
6                    0.201  30       0</code></pre>
</div>
</div>
<p>Si echamos una búsqueda rápida en google, observamos que el pedigree, es eso, la historia familiar de diabetes. Por lo tanto, aquí podríamso hacer varias cosas ! Entre ellas, regresar los datos a dicha función, o clasificar según esta variable, considerarla o no considerarla.</p>
<p>Para empezar vamos a considerarla para ver la clasificación del modelo knn y bayes.</p>
<section id="miramos-las-clases-de-los-datos" class="level2">
<h2 class="anchored" data-anchor-id="miramos-las-clases-de-los-datos">Miramos las clases de los datos</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(datos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   768 obs. of  9 variables:
 $ Pregnancies             : int  6 1 8 1 0 5 3 10 2 8 ...
 $ Glucose                 : int  148 85 183 89 137 116 78 115 197 125 ...
 $ BloodPressure           : int  72 66 64 66 40 74 50 0 70 96 ...
 $ SkinThickness           : int  35 29 0 23 35 0 32 0 45 0 ...
 $ Insulin                 : int  0 0 0 94 168 0 88 0 543 0 ...
 $ BMI                     : num  33.6 26.6 23.3 28.1 43.1 25.6 31 35.3 30.5 0 ...
 $ DiabetesPedigreeFunction: num  0.627 0.351 0.672 0.167 2.288 ...
 $ Age                     : int  50 31 32 21 33 30 26 29 53 54 ...
 $ Outcome                 : int  1 0 1 0 1 0 1 0 1 1 ...</code></pre>
</div>
</div>
<p>La única variable que debemos de cambiar es <code>Outcome</code> a factor. Donde 1 es diebetes, y 0 es no diabetes.</p>
<p><strong><em>La función as.factor() sirve para convertir la variable “Outcome” en un factor.</em></strong></p>
<p><strong><em>Esto significa que los valores de la variable “resultado” serán tratados como categorías o niveles en lugar de valores numéricos. Así, un valor de 1 indica la presencia de diabetes y un valor de 0 indica ausencia de diabetes.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>Outcome  <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(datos<span class="sc">$</span>Outcome)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="análisis-estadístico-preliminar" class="level1">
<h1>Análisis estadístico preliminar</h1>
<p><strong><em>Primero verificamos el tamaño de los datos usando la función dim(data).</em></strong></p>
<ul>
<li><strong><em>Esta función devuelve el número de filas y columnas en un conjunto de datos. Los datos tienen 768 filas y 9 columnas.</em></strong></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(datos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 768   9</code></pre>
</div>
</div>
<p>Tenemos 768 filas y 9 columnas. Analicemos primero dos a dos las variables una por una</p>
<section id="histogramas" class="level3">
<h3 class="anchored" data-anchor-id="histogramas">Histogramas</h3>
<p><strong><em>Se crea una lista llamada l.plots para almacenar los gráficos de los histograma.</em></strong></p>
<p><strong><em>La variable n1 como el número de columnas del conjunto de datos menos uno (porque no queremos considerar la variable objetivo “Outcome”).</em></strong></p>
<p><strong><em>El bucle for para iterar sobre cada columna del conjunto de datos, excluyendo la variable “Outcome”</em></strong></p>
<p><strong><em>Se calcula para cada columna un histograma utilizando la función hist(), con el argumento plot establecido como FALSE para evitar que se muestre el histograma de inmediato.</em></strong></p>
<p><strong><em>datos.tmp es un nuevo marco de datos que contiene los valores de la columna actual y la variable Outcome.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>l.plots <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>,<span class="at">length =</span> <span class="fu">ncol</span>(datos)<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="fu">ncol</span>(datos) <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n1){</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span><span class="fu">hist</span>(datos[,j],<span class="at">plot =</span> F)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  datos.tmp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">value=</span>datos[,j],<span class="at">outcome=</span>datos<span class="sc">$</span>Outcome)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(datos.tmp,<span class="fu">aes</span>(value,<span class="at">fill=</span>outcome))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">breaks=</span>h<span class="sc">$</span>breaks) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">"Histogram of"</span>, <span class="fu">colnames</span>(datos)[j]))</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  l.plots[[j]] <span class="ot">&lt;-</span> p1</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong><em>Esta línea de código muestra los histogramas generados anteriormente. Ejecutarlo imprime una lista de histogramas l.plots para cada variable.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>l.plots</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[2]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[3]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-7-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[4]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-7-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[5]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-7-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[6]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-7-6.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[7]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-7-7.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[8]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-7-8.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>En lo particular la variable del pedigree se me hace importante, entonces vamos a realizar gráficos de dispersión</p>
<p>En realidad, una buena práctica es correlacionar todas contra todas…</p>
<p><strong><em>La función ggscatterstats(): Se utilizó para generar un gráfico de dispersión entre las variables “BMI” (Índice de masa corporal) y “DiabetesPedigreeFunction” (Función de pedigrí de diabetes).</em></strong></p>
<ul>
<li><strong><em>El gráfico muestra la relación entre ambas variables y también proporciona la correlación y los intervalos de confianza.</em></strong></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggscatterstats</span>(datos,BMI,DiabetesPedigreeFunction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'ggside':
  method from   
  +.gg   ggplot2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Sin embargo, esto puede ser un proceso tedioso… imaginad hacer 16 gráficas ! podemos condersarlo todo.</p>
<p>Se realiza correlaciones entre las variables del conjunto de datos.</p>
<p><strong><em>Para ello se realiza un análisis de correlación y se muestra el resultado en una matriz de correlación visual con la función corrplot::corrplot().</em></strong></p>
<p><strong><em>La función psych::corr.test() permite el análisis de correlación.</em></strong></p>
<p><strong><em>Se seleccionan las primeras n1 columnas del conjunto de datos (datos[,1:n1]) y se aplica el test de correlación.</em></strong></p>
<p><strong><em>Los valores de correlación y los valores p correspondientes se almacenan en la variable obj.cor.</em></strong></p>
<p><strong><em>Luego, se realiza un ajuste de los valores p para controlar el error por múltiples comparaciones. Los valores p de la matriz triangular superior e inferior se reemplazan por los valores de p ajustados utilizando obj.cor$p.adj.</em></strong></p>
<p><strong><em>Se establece en 1 la diagonal de la matriz de valores p para que los valores p entre la misma variable sean 1 (ya que no tiene sentido calcular la correlación entre una variable y sí misma).</em></strong></p>
<p><strong><em>Los valores de correlación se toman de obj.cor$r y los valores p ajustados se pasan a p.mat.</em></strong></p>
<p><strong><em>Se utiliza un nivel de significancia de 0.05 (sig.level = 0.05) y las etiquetas para los valores insignificantes se muestran en el gráfico (insig = “label_sig”).</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>obj.cor <span class="ot">&lt;-</span> psych<span class="sc">::</span><span class="fu">corr.test</span>(datos[,<span class="dv">1</span><span class="sc">:</span>n1])</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>p.values <span class="ot">&lt;-</span> obj.cor<span class="sc">$</span>p</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>p.values[<span class="fu">upper.tri</span>(p.values)] <span class="ot">&lt;-</span> obj.cor<span class="sc">$</span>p.adj</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>p.values[<span class="fu">lower.tri</span>(p.values)] <span class="ot">&lt;-</span> obj.cor<span class="sc">$</span>p.adj</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(p.values) <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>corrplot<span class="sc">::</span><span class="fu">corrplot</span>(<span class="at">corr =</span> obj.cor<span class="sc">$</span>r,<span class="at">p.mat =</span> p.values,<span class="at">sig.level =</span> <span class="fl">0.05</span>,<span class="at">insig =</span> <span class="st">"label_sig"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Ahora podemos proceder a hacer algo similar, con una serie de comparaciones dos a dos sobre las medias o medianas, sobre cada variable y la variable de interés.</p>
<p>Primero debemos aplicar una regresión linear con variable dependiente cada variable numérica y por la categórica. Es decir un t.test pero con el fin de ver los residuos, para ver la normalidad de éstos.</p>
<p><strong><em>Se realiza un análisis de normalidad de los residuos utilizando la prueba de Shapiro-Wilk.</em></strong></p>
<p><strong><em>Se aplica una regresión lineal para cada variable numérica en relación a la variable “Outcome” (diabetes) utilizando lm(x~datos$Outcome).</em></strong></p>
<p><strong><em>Luego, se calculan los residuos de cada regresión mediante:</em></strong></p>
<ul>
<li><strong><em>summary(lm(x~datos$Outcome))$residuals.</em></strong></li>
</ul>
<p><strong><em>La función apply() se utiliza dos veces para aplicar la prueba de Shapiro-Wilk a los residuos de cada regresión (shapiro.test).</em></strong></p>
<p><strong><em>Se utiliza apply(datos[,1:n1], 2, ...) para aplicar la función a cada columna del conjunto de datos `datos[,1:n1]`.</em></strong></p>
<p><strong><em>El resultado se almacena en p.norm , estos valores indican si los residuos se ajustan.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>p.norm <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">apply</span>(datos[,<span class="dv">1</span><span class="sc">:</span>n1],</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>            <span class="dv">2</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(x) <span class="fu">summary</span>(<span class="fu">lm</span>(x<span class="sc">~</span>datos<span class="sc">$</span>Outcome))<span class="sc">$</span>residuals),</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>      <span class="dv">2</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>      shapiro.test)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>p.norm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Pregnancies

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.9389, p-value &lt; 2.2e-16


$Glucose

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.97511, p-value = 3.726e-10


$BloodPressure

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.81468, p-value &lt; 2.2e-16


$SkinThickness

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.92004, p-value &lt; 2.2e-16


$Insulin

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.77776, p-value &lt; 2.2e-16


$BMI

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.94359, p-value &lt; 2.2e-16


$DiabetesPedigreeFunction

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.84939, p-value &lt; 2.2e-16


$Age

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.88114, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Todas las variables son no normales, tal como vemos en los histogramas.</p>
<p><strong><em>La función ggbetweenstats()realiza una comparación entre las variables “Pregnancies” y “Outcome” utilizando pruebas no paramétricas.</em></strong></p>
<p><strong><em>Genera un gráfico que muestra la distribución de la variable “Pregnancies” para cada categoría de la variable “Outcome” (diabetes o no diabetes).</em></strong></p>
<p><strong><em>El tipo de prueba no paramétrica se especifica mediante el argumento type = “nonparametric”.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbetweenstats</span>(datos,Outcome,Pregnancies,<span class="at">type =</span> <span class="st">"nonparametric"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbetweenstats</span>(datos,Outcome,Glucose,<span class="at">type =</span> <span class="st">"nonparametric"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbetweenstats</span>(datos,Outcome,BloodPressure,<span class="at">type =</span> <span class="st">"nonparametric"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbetweenstats</span>(datos,Outcome,Insulin,<span class="at">type =</span> <span class="st">"nonparametric"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbetweenstats</span>(datos,Outcome,BMI,<span class="at">type =</span> <span class="st">"nonparametric"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbetweenstats</span>(datos,Outcome,DiabetesPedigreeFunction,<span class="at">type =</span> <span class="st">"nonparametric"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbetweenstats</span>(datos,Outcome,Age,<span class="at">type =</span> <span class="st">"nonparametric"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="pca" class="level3">
<h3 class="anchored" data-anchor-id="pca">PCA</h3>
<p>Con la función prcomp() se realiza un análisis de Componentes Principales (PCA).</p>
<p>Se seleccionan las primeras n1 columnas del conjunto de datos (datos[,1:n1]).</p>
<p>Los datos no se escalan (scale. = F) por la variabilidad de los datos.</p>
<p>Después de realizar el PCA, se obtienen los valores de las componentes principales (pcx$x) y se combinan con la variable “Outcome” del conjunto de datos (datos$Outcome) mediante la función bind_cols() para crear un nuevo conjunto de datos llamado plotpca.</p>
<p>Se utiliza ggplot() para generar un gráfico de dispersión de (PC1 y PC2) .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(datos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Pregnancies        Glucose      BloodPressure    SkinThickness  
 Min.   : 0.000   Min.   :  0.0   Min.   :  0.00   Min.   : 0.00  
 1st Qu.: 1.000   1st Qu.: 99.0   1st Qu.: 62.00   1st Qu.: 0.00  
 Median : 3.000   Median :117.0   Median : 72.00   Median :23.00  
 Mean   : 3.845   Mean   :120.9   Mean   : 69.11   Mean   :20.54  
 3rd Qu.: 6.000   3rd Qu.:140.2   3rd Qu.: 80.00   3rd Qu.:32.00  
 Max.   :17.000   Max.   :199.0   Max.   :122.00   Max.   :99.00  
    Insulin           BMI        DiabetesPedigreeFunction      Age       
 Min.   :  0.0   Min.   : 0.00   Min.   :0.0780           Min.   :21.00  
 1st Qu.:  0.0   1st Qu.:27.30   1st Qu.:0.2437           1st Qu.:24.00  
 Median : 30.5   Median :32.00   Median :0.3725           Median :29.00  
 Mean   : 79.8   Mean   :31.99   Mean   :0.4719           Mean   :33.24  
 3rd Qu.:127.2   3rd Qu.:36.60   3rd Qu.:0.6262           3rd Qu.:41.00  
 Max.   :846.0   Max.   :67.10   Max.   :2.4200           Max.   :81.00  
 Outcome
 0:500  
 1:268  
        
        
        
        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>pcx <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(datos[,<span class="dv">1</span><span class="sc">:</span>n1],<span class="at">scale. =</span> F) <span class="do">## escalamos por la variablidad de los datos</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>plotpca <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(pcx<span class="sc">$</span>x,<span class="at">outcome=</span>datos<span class="sc">$</span>Outcome)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plotpca,<span class="fu">aes</span>(PC1,PC2,<span class="at">color=</span>outcome))<span class="sc">+</span><span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Ahora vamos a ver si haciendo unas transformaciones esto cambia. Pero antes debemos de ver las variables sospechosas…</p>
<p>Pero de igual manera podemos escalar a ver si hay algun cambio.</p>
<p><strong><em>Se escalan los datos (`scale. = T`) antes de realizar el PCA</em></strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(datos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Pregnancies        Glucose      BloodPressure    SkinThickness  
 Min.   : 0.000   Min.   :  0.0   Min.   :  0.00   Min.   : 0.00  
 1st Qu.: 1.000   1st Qu.: 99.0   1st Qu.: 62.00   1st Qu.: 0.00  
 Median : 3.000   Median :117.0   Median : 72.00   Median :23.00  
 Mean   : 3.845   Mean   :120.9   Mean   : 69.11   Mean   :20.54  
 3rd Qu.: 6.000   3rd Qu.:140.2   3rd Qu.: 80.00   3rd Qu.:32.00  
 Max.   :17.000   Max.   :199.0   Max.   :122.00   Max.   :99.00  
    Insulin           BMI        DiabetesPedigreeFunction      Age       
 Min.   :  0.0   Min.   : 0.00   Min.   :0.0780           Min.   :21.00  
 1st Qu.:  0.0   1st Qu.:27.30   1st Qu.:0.2437           1st Qu.:24.00  
 Median : 30.5   Median :32.00   Median :0.3725           Median :29.00  
 Mean   : 79.8   Mean   :31.99   Mean   :0.4719           Mean   :33.24  
 3rd Qu.:127.2   3rd Qu.:36.60   3rd Qu.:0.6262           3rd Qu.:41.00  
 Max.   :846.0   Max.   :67.10   Max.   :2.4200           Max.   :81.00  
 Outcome
 0:500  
 1:268  
        
        
        
        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>pcx <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(datos[,<span class="dv">1</span><span class="sc">:</span>n1],<span class="at">scale. =</span> T) <span class="do">## escalamos por la variablidad de los datos</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>plotpca <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(pcx<span class="sc">$</span>x,<span class="at">outcome=</span>datos<span class="sc">$</span>Outcome)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plotpca,<span class="fu">aes</span>(PC1,PC2,<span class="at">color=</span>outcome))<span class="sc">+</span><span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong><em>La función factoextra::fviz_contrib() para visualizar las contribuciones de las variables a las componentes principales obtenidas en el PCA.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>factoextra<span class="sc">::</span><span class="fu">fviz_contrib</span>(pcx,<span class="st">"var"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Al parecer es la insulina la que está dando problemas.</p>
<p><strong><em>Se quita la variable “Insulin” del conjunto de datos mediante la creación de un índice w que contiene los índices de las columnas que contienen “insulin” y el número total de columnas (ncol(datos)).</em></strong></p>
<p><strong><em>Luego, se seleccionan todas las columnas excepto las indicadas en el índice w para realizar el PCA sin escalar los datos nuevamente, utilizando datos [, -w] en la función prcomp().</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="do">## indices a quitar</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">grep</span>(<span class="st">"insulin"</span>,<span class="at">ignore.case =</span> T,<span class="fu">colnames</span>(datos)),<span class="fu">ncol</span>(datos))</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>pcx <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(datos[,<span class="sc">-</span>w],<span class="at">scale. =</span> F) <span class="do">## escalamos por la variablidad de los datos</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>plotpca <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(pcx<span class="sc">$</span>x,<span class="at">outcome=</span>datos<span class="sc">$</span>Outcome)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plotpca,<span class="fu">aes</span>(PC1,PC2,<span class="at">color=</span>outcome))<span class="sc">+</span><span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>De hecho la insulina, tenía un aspecto raro, como sesgado, ver gráficos de arriba. Vamos a transformala.</p>
<p><strong><em>Luego de la transformación, se realizó el PCA escalando los datos.</em></strong></p>
<p><strong><em>Utilizando scale. = TRUE en la función prcomp(). Luego, se generan los gráficos de dispersión de las dos primeras componentes principales.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>Insulin  <span class="ot">&lt;-</span> <span class="fu">log</span>(datos<span class="sc">$</span>Insulin<span class="fl">+0.05</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(datos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Pregnancies        Glucose      BloodPressure    SkinThickness  
 Min.   : 0.000   Min.   :  0.0   Min.   :  0.00   Min.   : 0.00  
 1st Qu.: 1.000   1st Qu.: 99.0   1st Qu.: 62.00   1st Qu.: 0.00  
 Median : 3.000   Median :117.0   Median : 72.00   Median :23.00  
 Mean   : 3.845   Mean   :120.9   Mean   : 69.11   Mean   :20.54  
 3rd Qu.: 6.000   3rd Qu.:140.2   3rd Qu.: 80.00   3rd Qu.:32.00  
 Max.   :17.000   Max.   :199.0   Max.   :122.00   Max.   :99.00  
    Insulin            BMI        DiabetesPedigreeFunction      Age       
 Min.   :-2.996   Min.   : 0.00   Min.   :0.0780           Min.   :21.00  
 1st Qu.:-2.996   1st Qu.:27.30   1st Qu.:0.2437           1st Qu.:24.00  
 Median : 3.418   Median :32.00   Median :0.3725           Median :29.00  
 Mean   : 1.008   Mean   :31.99   Mean   :0.4719           Mean   :33.24  
 3rd Qu.: 4.847   3rd Qu.:36.60   3rd Qu.:0.6262           3rd Qu.:41.00  
 Max.   : 6.741   Max.   :67.10   Max.   :2.4200           Max.   :81.00  
 Outcome
 0:500  
 1:268  
        
        
        
        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>pcx <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(datos[,<span class="dv">1</span><span class="sc">:</span>n1],<span class="at">scale. =</span> T) <span class="do">## escalamos por la variablidad de los datos</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>plotpca <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(pcx<span class="sc">$</span>x,<span class="at">outcome=</span>datos<span class="sc">$</span>Outcome)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plotpca,<span class="fu">aes</span>(PC1,PC2,<span class="at">color=</span>outcome))<span class="sc">+</span><span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Cambia ! Esto significa que no hemos quitado la infromacion de la insulina, solamente lo hemos transformado</p>
<p>Es decir, cambia si transformamos los datos…a partir de esto, podemos realizar de nuevo pruebas de diferencia de medianas, pero ahora lo veremos condensado..</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./datos/diabetes.csv"</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>Outcome <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(datos<span class="sc">$</span>Outcome)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>datsc <span class="ot">&lt;-</span> <span class="fu">scale</span>(datos[,<span class="sc">-</span><span class="fu">ncol</span>(datos)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Veamos las distribuciones de nuevo</p>
<p><strong><em>La visualización de las distribuciones utilizando un bucle for. Se genera un histograma para cada variable y se almacena en una lista l.plots.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>l.plots <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>,<span class="at">length =</span> <span class="fu">ncol</span>(datos)<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="fu">ncol</span>(datos) <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n1){</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span><span class="fu">hist</span>(datos[,j],<span class="at">plot =</span> F)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  datos.tmp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">value=</span>datos[,j],<span class="at">outcome=</span>datos<span class="sc">$</span>Outcome)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(datos.tmp,<span class="fu">aes</span>(value,<span class="at">fill=</span>outcome))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">breaks=</span>h<span class="sc">$</span>breaks) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">"Histogram of"</span>, <span class="fu">colnames</span>(datos)[j]))</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  l.plots[[j]] <span class="ot">&lt;-</span> p1</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>l.plots</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[2]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-24-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[3]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-24-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[4]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-24-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[5]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-24-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[6]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-24-6.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[7]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-24-7.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[8]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-24-8.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Curioso, los valores la insulina, han cambiado por la transformación en valor mas no la distribución, vamos a hacer unos arrelgos…</p>
<p>Al parecer la preñanza esta ligada a una esgala logaritmica de 2 Esto es otra cosa…</p>
<p><strong><em>Se cargan los datos originales read.csv().</em></strong></p>
<p><strong><em>Se convierte la variable “Outcome” en un factor utilizando as.factor().</em></strong></p>
<p><strong><em>Después, se realiza una transformación logarítmica en la variable “Pregnancies” agregando 0.5 a cada valor antes de aplicar el logaritmo.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./datos/diabetes.csv"</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>Outcome <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(datos<span class="sc">$</span>Outcome)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>Pregnancies  <span class="ot">&lt;-</span> <span class="fu">log</span>(datos<span class="sc">$</span>Pregnancies<span class="fl">+0.5</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datos,<span class="fu">aes</span>(Pregnancies))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">breaks =</span> <span class="fu">hist</span>(datos<span class="sc">$</span>Pregnancies,<span class="at">plot=</span>F)<span class="sc">$</span>breaks)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Realizaremos lo mismo con la grosura de la piel</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./datos/diabetes.csv"</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>Outcome <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(datos<span class="sc">$</span>Outcome)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>SkinThickness  <span class="ot">&lt;-</span> <span class="fu">log</span>(datos<span class="sc">$</span>SkinThickness<span class="fl">+0.5</span>)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datos,<span class="fu">aes</span>(SkinThickness))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">breaks =</span> <span class="fu">hist</span>(datos<span class="sc">$</span>SkinThickness,<span class="at">plot=</span>F)<span class="sc">$</span>breaks)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Tenemos algo raro, lo más posible sea por la obesidad…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggscatterstats</span>(datos,SkinThickness,BMI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Curioso ! al parecer los datos tienen valores nulos, los cuales solo están en las otras variables que no sean pregnancies. Vamos a quitarlos.</p>
<p><strong><em>La función apply() junto con ifelse() reemplazan los valores nulos (0) en todas las columnas, excepto en las columnas “Pregnancies” y “Outcome”, con NA.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./datos/diabetes.csv"</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>datos[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">9</span>)] <span class="ot">&lt;-</span> <span class="fu">apply</span>(datos[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">9</span>)],<span class="dv">2</span>,<span class="cf">function</span>(x) <span class="fu">ifelse</span>(x<span class="sc">==</span><span class="dv">0</span>,<span class="cn">NA</span>,x))</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>Outcome <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(datos<span class="sc">$</span>Outcome)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="vamos-a-quitar-estos-valores" class="level3">
<h3 class="anchored" data-anchor-id="vamos-a-quitar-estos-valores">Vamos a quitar estos valores</h3>
<p><strong><em>La función complete.cases() identifica las filas en el conjunto de datos donde no hay valores faltantes en ninguna columna.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> datos[<span class="fu">complete.cases</span>(datos),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Se redujo el data set a 392 observaciones…</p>
<p><strong><em>La función table() para obtener la frecuencia de cada nivel en la variable “Outcome” del conjunto de datos actualizado.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(datos<span class="sc">$</span>Outcome)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  0   1 
262 130 </code></pre>
</div>
</div>
<p><strong><em>Se crea una lista l.plots vacía con una longitud igual al número de columnas en datos menos 1.</em></strong></p>
<p><strong><em>Se crea un nuevo data frame datos.tmp con las columnas “value” y “outcome”</em></strong></p>
<p><strong><em>“value” contiene los valores de la columna actual</em></strong></p>
<p><strong><em>“outcome” contiene los valores de la variable “Outcome”</em></strong></p>
<p><strong><em>ggplot() para crear un gráfico de histograma utilizando datos.tmp y se agrega a la lista l.plots en la posición correspondiente.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>l.plots <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>,<span class="at">length =</span> <span class="fu">ncol</span>(datos)<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="fu">ncol</span>(datos) <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n1){</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span><span class="fu">hist</span>(datos[,j],<span class="at">plot =</span> F)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  datos.tmp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">value=</span>datos[,j],<span class="at">outcome=</span>datos<span class="sc">$</span>Outcome)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(datos.tmp,<span class="fu">aes</span>(value,<span class="at">fill=</span>outcome))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">breaks=</span>h<span class="sc">$</span>breaks) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">"Histogram of"</span>, <span class="fu">colnames</span>(datos)[j]))</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>  l.plots[[j]] <span class="ot">&lt;-</span> p1</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>l.plots</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[2]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-31-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[3]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-31-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[4]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-31-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[5]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-31-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[6]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-31-6.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[7]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-31-7.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[8]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-31-8.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Ahora si podemos realizar las transfomraciones</p>
<p><strong><em>Se carga el archivo “diabetes.csv” en el objeto datos.</em></strong></p>
<p><strong><em>Se reemplazan los valores cero en todas las columnas excepto la primera y la novena con valores NA.</em></strong></p>
<p><strong><em>La función apply() para iterar sobre las columnas y la función ifelse() para reemplazar los valores cero por NA.</em></strong></p>
<p><strong><em>Se convierte la columna “Outcome” en una variable categórica/factor utilizando la función as.factor().</em></strong></p>
<p>datos$Insulin &lt;- log(datos$Insulin)</p>
<p>datos$Pregnancies &lt;- log(datos$Pregnancies+0.5)</p>
<p>datos$DiabetesPedigreeFunction &lt;- log(datos$DiabetesPedigreeFunction)</p>
<p><strong><em>Se aplica la función logarítmica “Insulin”, “Pregnancies” y “DiabetesPedigreeFunction” para realizar una transformación logarítmica.</em></strong></p>
<p>datos$SkinThickness &lt;- sqrt((datos$SkinThickness))</p>
<p>datos$Glucose &lt;- log(datos$Glucose)</p>
<p>datos$Age &lt;-log2(datos$Age)</p>
<p><strong><em>La función raíz cuadrada a la columna “SkinThickness”</em></strong></p>
<p><strong><em>Se aplica la función logarítmica base 2 a las columnas “Glucose” y “Age”.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./datos/diabetes.csv"</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>datos[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">9</span>)] <span class="ot">&lt;-</span> <span class="fu">apply</span>(datos[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">9</span>)],<span class="dv">2</span>,<span class="cf">function</span>(x) <span class="fu">ifelse</span>(x<span class="sc">==</span><span class="dv">0</span>,<span class="cn">NA</span>,x))</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> datos[<span class="fu">complete.cases</span>(datos),]</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>Outcome <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(datos<span class="sc">$</span>Outcome)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>Insulin <span class="ot">&lt;-</span> <span class="fu">log</span>(datos<span class="sc">$</span>Insulin)</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>Pregnancies <span class="ot">&lt;-</span> <span class="fu">log</span>(datos<span class="sc">$</span>Pregnancies<span class="fl">+0.5</span>)</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>DiabetesPedigreeFunction <span class="ot">&lt;-</span> <span class="fu">log</span>(datos<span class="sc">$</span>DiabetesPedigreeFunction)</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>SkinThickness <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((datos<span class="sc">$</span>SkinThickness))</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>Glucose <span class="ot">&lt;-</span> <span class="fu">log</span>(datos<span class="sc">$</span>Glucose)</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>Age <span class="ot">&lt;-</span><span class="fu">log2</span>(datos<span class="sc">$</span>Age)</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>l.plots <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>,<span class="at">length =</span> <span class="fu">ncol</span>(datos)<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="fu">ncol</span>(datos) <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n1){</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span><span class="fu">hist</span>(datos[,j],<span class="at">plot =</span> F)</span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>  datos.tmp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">value=</span>datos[,j],<span class="at">outcome=</span>datos<span class="sc">$</span>Outcome)</span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(datos.tmp,<span class="fu">aes</span>(value,<span class="at">fill=</span>outcome))<span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">breaks=</span>h<span class="sc">$</span>breaks) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">"Histogram of"</span>, <span class="fu">colnames</span>(datos)[j]))</span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>  l.plots[[j]] <span class="ot">&lt;-</span> p1</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>l.plots</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[2]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-32-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[3]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-32-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[4]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-32-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[5]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-32-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[6]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-32-6.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[7]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-32-7.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[8]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-32-8.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Con las anteriores transformaciones vamos a realizar el PCA de nuevo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(datos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Pregnancies         Glucose      BloodPressure    SkinThickness  
 Min.   :-0.6931   Min.   :4.025   Min.   : 24.00   Min.   :2.646  
 1st Qu.: 0.4055   1st Qu.:4.595   1st Qu.: 62.00   1st Qu.:4.583  
 Median : 0.9163   Median :4.779   Median : 70.00   Median :5.385  
 Mean   : 0.9590   Mean   :4.778   Mean   : 70.66   Mean   :5.305  
 3rd Qu.: 1.7047   3rd Qu.:4.963   3rd Qu.: 78.00   3rd Qu.:6.083  
 Max.   : 2.8622   Max.   :5.288   Max.   :110.00   Max.   :7.937  
    Insulin           BMI        DiabetesPedigreeFunction      Age       
 Min.   :2.639   Min.   :18.20   Min.   :-2.4651          Min.   :4.392  
 1st Qu.:4.341   1st Qu.:28.40   1st Qu.:-1.3103          1st Qu.:4.524  
 Median :4.832   Median :33.20   Median :-0.7996          Median :4.755  
 Mean   :4.813   Mean   :33.09   Mean   :-0.8391          Mean   :4.882  
 3rd Qu.:5.247   3rd Qu.:37.10   3rd Qu.:-0.3754          3rd Qu.:5.170  
 Max.   :6.741   Max.   :67.10   Max.   : 0.8838          Max.   :6.340  
 Outcome
 0:262  
 1:130  
        
        
        
        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>pcx <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(datos[,<span class="dv">1</span><span class="sc">:</span>n1],<span class="at">scale. =</span> T) <span class="do">## escalamos por la variablidad de los datos</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>plotpca <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(pcx<span class="sc">$</span>x,<span class="at">outcome=</span>datos<span class="sc">$</span>Outcome)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plotpca,<span class="fu">aes</span>(PC1,PC2,<span class="at">color=</span>outcome))<span class="sc">+</span><span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Ahora vamos a realizar las pruebas de medianas</p>
<p><strong><em>Utilizando la función wilcox.test(): En cada variable transformada con respecto a la variable de resultado.</em></strong></p>
<p><strong><em>Los resultados de las pruebas se almacenan en el objeto p.norm.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>p.norm <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">apply</span>(<span class="fu">scale</span>(datos[,<span class="dv">1</span><span class="sc">:</span>n1]),</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>            <span class="dv">2</span>,</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(x) <span class="fu">summary</span>(<span class="fu">lm</span>(x<span class="sc">~</span>datos<span class="sc">$</span>Outcome))<span class="sc">$</span>residuals),</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>      <span class="dv">2</span>,</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>      shapiro.test)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>p.norm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Pregnancies

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.95146, p-value = 4.684e-10


$Glucose

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.9958, p-value = 0.3813


$BloodPressure

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.99011, p-value = 0.009686


$SkinThickness

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.99384, p-value = 0.1123


$Insulin

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.99054, p-value = 0.0128


$BMI

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.97122, p-value = 5.374e-07


$DiabetesPedigreeFunction

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.99456, p-value = 0.1796


$Age

    Shapiro-Wilk normality test

data:  newX[, i]
W = 0.93053, p-value = 1.561e-12</code></pre>
</div>
</div>
<p>Hemos conseguido la normalidad en solo dos variables, si fueran mas procederiamos con t test pero como no es asi, con test de Wilcoxon</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>p.norm <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">scale</span>(datos[,<span class="dv">1</span><span class="sc">:</span>n1]),</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>            <span class="dv">2</span>,</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(x) <span class="fu">wilcox.test</span>(x<span class="sc">~</span>datos<span class="sc">$</span>Outcome)<span class="sc">$</span>p.value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Observamos que en una primera instancia ahora todas tienen diferencias significativas, esto tenemos que corregir.</p>
<p><strong><em>Utilizando el método de Benjamini-Hochberg se realiza un ajuste de (p valor) para corregir el problema de la comparación múltiple.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>p.adj <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(p.norm,<span class="st">"BH"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Todas siguen siendo significativas, ahora vamos a ver cuales aumentan o disminyuen respecto las otras.</p>
<p><strong><em>Utilizando la función split(): Se dividen los datos en grupos según la variable de resultado.</em></strong></p>
<p><strong><em>Se calculan las medianas de cada variable para cada grupo utilizando la función apply() y se almacenan en el objeto datos.median</em></strong></p>
<p><strong><em>Se crea un data frame llamado toplot que contiene las diferencias de medianas entre los grupos (calculadas restando las medianas de los grupos) y los p-valores corregidos.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>datos.split <span class="ot">&lt;-</span> <span class="fu">split</span>(datos,datos<span class="sc">$</span>Outcome)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>datos.median <span class="ot">&lt;-</span> <span class="fu">lapply</span>(datos.split, <span class="cf">function</span>(x) <span class="fu">apply</span>(x[,<span class="sc">-</span><span class="fu">ncol</span>(x)],<span class="dv">2</span>,median))</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>toplot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">medianas=</span><span class="fu">Reduce</span>(<span class="st">"-"</span>,datos.median)</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>,<span class="at">p.values=</span>p.adj)</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>toplot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           medianas     p.values
Pregnancies              -0.3364722 8.957407e-05
Glucose                  -0.2957935 4.902429e-22
BloodPressure            -4.0000000 8.957407e-05
SkinThickness            -0.5484102 4.309442e-07
Insulin                  -0.4788534 3.241934e-13
BMI                      -3.3500000 2.574728e-07
DiabetesPedigreeFunction -0.2779529 8.957407e-05
Age                      -0.4005379 1.577456e-14</code></pre>
</div>
</div>
<p>Ahora Todos los valores son significativos respecto a la obesidad</p>
<p><strong><em>La función corr.test() realiza una prueba de correlación en todas las variables transformadas.</em></strong></p>
<p><strong><em>Los p-valores resultantes se almacenan en el objeto p.values.</em></strong></p>
<p><strong><em>Un ajuste de p-valor utilizando el método de Benjamini-Hochberg para corregir la comparación múltiple.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>obj.cor <span class="ot">&lt;-</span> psych<span class="sc">::</span><span class="fu">corr.test</span>(datos[,<span class="dv">1</span><span class="sc">:</span>n1])</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>p.values <span class="ot">&lt;-</span> obj.cor<span class="sc">$</span>p</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>p.values[<span class="fu">upper.tri</span>(p.values)] <span class="ot">&lt;-</span> obj.cor<span class="sc">$</span>p.adj</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>p.values[<span class="fu">lower.tri</span>(p.values)] <span class="ot">&lt;-</span> obj.cor<span class="sc">$</span>p.adj</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(p.values) <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>corrplot<span class="sc">::</span><span class="fu">corrplot</span>(<span class="at">corr =</span> obj.cor<span class="sc">$</span>r,<span class="at">p.mat =</span> p.values,<span class="at">sig.level =</span> <span class="fl">0.05</span>,<span class="at">insig =</span> <span class="st">"label_sig"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>También podemos observar como cambian las relaciones segun la diabetes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>obj.cor <span class="ot">&lt;-</span> psych<span class="sc">::</span><span class="fu">corr.test</span>(datos[datos<span class="sc">$</span>Outcome<span class="sc">==</span><span class="dv">0</span>,<span class="dv">1</span><span class="sc">:</span>n1])</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>p.values <span class="ot">&lt;-</span> obj.cor<span class="sc">$</span>p</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>p.values[<span class="fu">upper.tri</span>(p.values)] <span class="ot">&lt;-</span> obj.cor<span class="sc">$</span>p.adj</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>p.values[<span class="fu">lower.tri</span>(p.values)] <span class="ot">&lt;-</span> obj.cor<span class="sc">$</span>p.adj</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(p.values) <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>corrplot<span class="sc">::</span><span class="fu">corrplot</span>(<span class="at">corr =</span> obj.cor<span class="sc">$</span>r,<span class="at">p.mat =</span> p.values,<span class="at">sig.level =</span> <span class="fl">0.05</span>,<span class="at">insig =</span> <span class="st">"label_sig"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>obj.cor <span class="ot">&lt;-</span> psych<span class="sc">::</span><span class="fu">corr.test</span>(datos[datos<span class="sc">$</span>Outcome<span class="sc">==</span><span class="dv">1</span>,<span class="dv">1</span><span class="sc">:</span>n1])</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>p.values <span class="ot">&lt;-</span> obj.cor<span class="sc">$</span>p</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>p.values[<span class="fu">upper.tri</span>(p.values)] <span class="ot">&lt;-</span> obj.cor<span class="sc">$</span>p.adj</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>p.values[<span class="fu">lower.tri</span>(p.values)] <span class="ot">&lt;-</span> obj.cor<span class="sc">$</span>p.adj</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(p.values) <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>corrplot<span class="sc">::</span><span class="fu">corrplot</span>(<span class="at">corr =</span> obj.cor<span class="sc">$</span>r,<span class="at">p.mat =</span> p.values,<span class="at">sig.level =</span> <span class="fl">0.05</span>,<span class="at">insig =</span> <span class="st">"label_sig"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Es decir, existen correlaciones únicas de la obesidad y no obesidad, y existen otras correlaciones que son debidas a otros factores.</p>
</section>
</section>
<section id="particion-de-datos" class="level1">
<h1>Particion de datos</h1>
<p><strong><em>Partición de los datos en conjuntos de entrenamiento y prueba.</em></strong></p>
<p><strong><em>la función scale(), centra y escala cada variable para tener media cero y desviación estándar uno.</em></strong></p>
<p><strong><em>Utilizando la función levels() se cambian los niveles de la variable de resultado Outcome a “D” (diabetes) y “N” (no diabetes)</em></strong></p>
<p><strong><em>Un conjunto de entrenamiento mediante la función sample(), que selecciona aleatoriamente un subconjunto de filas del dataframe datos para formar el conjunto de entrenamiento.</em></strong></p>
<p><strong><em>El tamaño del conjunto de entrenamiento que representa el 70% de los datos.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>datos[,<span class="dv">1</span><span class="sc">:</span>n1] <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">scale</span>(datos[,<span class="sc">-</span><span class="fu">ncol</span>(datos)]))</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(datos<span class="sc">$</span>Outcome) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"D"</span>,<span class="st">"N"</span>)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(datos),<span class="at">size =</span> <span class="fu">nrow</span>(datos)<span class="sc">*</span><span class="fl">0.7</span>)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>dat.train <span class="ot">&lt;-</span> datos[train,]</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>dat.test <span class="ot">&lt;-</span> datos[<span class="sc">-</span>train,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="modelado" class="level1">
<h1>Modelado</h1>
<p><strong><em>Se ajusta un modelo de regresión logística utilizando la función glm().</em></strong></p>
<p><strong><em>Outcome ~ . dice que se utiliza la variable Outcome como la variable de respuesta y todas las demás variables como predictores.</em></strong></p>
<p><strong><em>family = “binomial” indica que se trata de un modelo de regresión logística.</em></strong></p>
<p><strong><em>La función predict() aplicada al modelo ajustado glm.mod. El argumento type = “response” especifica que se obtengan las probabilidades de pertenecer a la clase positiva (diabetes).</em></strong></p>
<p><strong><em>Estas probabilidades se convierten en etiquetas de clase utilizando un umbral de corte de 0.5 y se asignan a la variable predicción.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>datos[,<span class="dv">1</span><span class="sc">:</span>n1] <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">scale</span>(datos[,<span class="sc">-</span><span class="fu">ncol</span>(datos)]))</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>glm.mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(Outcome <span class="sc">~</span>.,<span class="at">data=</span>dat.train,<span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>prediccion <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(<span class="fu">predict</span>(glm.mod,dat.test,<span class="at">type=</span><span class="st">"response"</span>)<span class="sc">&gt;=</span><span class="fl">0.5</span>,<span class="st">"N"</span>,<span class="st">"D"</span>))</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(prediccion,dat.test<span class="sc">$</span>Outcome)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction  D  N
         D 66 22
         N 11 19
                                         
               Accuracy : 0.7203         
                 95% CI : (0.6302, 0.799)
    No Information Rate : 0.6525         
    P-Value [Acc &gt; NIR] : 0.07178        
                                         
                  Kappa : 0.342          
                                         
 Mcnemar's Test P-Value : 0.08172        
                                         
            Sensitivity : 0.8571         
            Specificity : 0.4634         
         Pos Pred Value : 0.7500         
         Neg Pred Value : 0.6333         
             Prevalence : 0.6525         
         Detection Rate : 0.5593         
   Detection Prevalence : 0.7458         
      Balanced Accuracy : 0.6603         
                                         
       'Positive' Class : D              
                                         </code></pre>
</div>
</div>
<p>LASSO</p>
<p><strong><em>Se establece un único valor de alpha en 0</em></strong></p>
<p><strong><em>Se generan valores de lambda en el rango de 0 a 1 con un incremento de 0.001.</em></strong></p>
<p><strong><em>Se define el control de entrenamiento trainControl para realizar una validación cruzada repetida.</em></strong></p>
<p><strong><em>El método de validación cruzada “repeatedcv”, con 10 pliegues y 3 repeticiones.</em></strong></p>
<p><strong><em>classProbs = TRUE se establece para que se calculen las probabilidades de clase.</em></strong></p>
<p><strong><em>Se especifica el método “glmnet” para utilizar LASSO y se proporcionan los datos de entrenamiento dat.train.</em></strong></p>
<p><strong><em>Se realizan predicciones en el conjunto de prueba utilizando la función predict() aplicada al modelo model.</em></strong></p>
<p><strong><em>Las etiquetas predichas se comparan con las etiquetas reales dat.test$Outcome y se calcula la matriz de confusión utilizando la función confusionMatrix().</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>tuneGrid<span class="ot">=</span><span class="fu">expand.grid</span>(</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">.alpha=</span><span class="dv">0</span>,</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">.lambda=</span><span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.001</span>))</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>trainControl <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"repeatedcv"</span>,</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">number =</span> <span class="dv">10</span>,</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">repeats =</span> <span class="dv">3</span>,</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>                       <span class="co"># prSummary needs calculated class,</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">classProbs =</span> T)</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(Outcome <span class="sc">~</span> ., <span class="at">data =</span> dat.train, <span class="at">method =</span> <span class="st">"glmnet"</span>, <span class="at">trControl =</span> trainControl,<span class="at">tuneGrid=</span>tuneGrid,</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">metric=</span><span class="st">"Accuracy"</span></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="fu">predict</span>(model,dat.test[,<span class="sc">-</span><span class="fu">ncol</span>(dat.test)]),dat.test<span class="sc">$</span>Outcome)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction  D  N
         D 69 23
         N  8 18
                                         
               Accuracy : 0.7373         
                 95% CI : (0.6483, 0.814)
    No Information Rate : 0.6525         
    P-Value [Acc &gt; NIR] : 0.03110        
                                         
                  Kappa : 0.3665         
                                         
 Mcnemar's Test P-Value : 0.01192        
                                         
            Sensitivity : 0.8961         
            Specificity : 0.4390         
         Pos Pred Value : 0.7500         
         Neg Pred Value : 0.6923         
             Prevalence : 0.6525         
         Detection Rate : 0.5847         
   Detection Prevalence : 0.7797         
      Balanced Accuracy : 0.6676         
                                         
       'Positive' Class : D              
                                         </code></pre>
</div>
</div>
<p><strong><em>alpha en 1</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>tuneGrid<span class="ot">=</span><span class="fu">expand.grid</span>(</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">.alpha=</span><span class="dv">1</span>,</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">.lambda=</span><span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.0001</span>))</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>trainControl <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"repeatedcv"</span>,</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">number =</span> <span class="dv">10</span>,</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">repeats =</span> <span class="dv">3</span>,</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>                       <span class="co"># prSummary needs calculated class,</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">classProbs =</span> T)</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(Outcome <span class="sc">~</span> ., <span class="at">data =</span> dat.train, <span class="at">method =</span> <span class="st">"glmnet"</span>, <span class="at">trControl =</span> trainControl,<span class="at">tuneGrid=</span>tuneGrid,</span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">metric=</span><span class="st">"Accuracy"</span></span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="fu">predict</span>(model,dat.test[,<span class="sc">-</span><span class="fu">ncol</span>(dat.test)]),dat.test<span class="sc">$</span>Outcome)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction  D  N
         D 67 22
         N 10 19
                                          
               Accuracy : 0.7288          
                 95% CI : (0.6392, 0.8065)
    No Information Rate : 0.6525          
    P-Value [Acc &gt; NIR] : 0.04813         
                                          
                  Kappa : 0.358           
                                          
 Mcnemar's Test P-Value : 0.05183         
                                          
            Sensitivity : 0.8701          
            Specificity : 0.4634          
         Pos Pred Value : 0.7528          
         Neg Pred Value : 0.6552          
             Prevalence : 0.6525          
         Detection Rate : 0.5678          
   Detection Prevalence : 0.7542          
      Balanced Accuracy : 0.6668          
                                          
       'Positive' Class : D               
                                          </code></pre>
</div>
</div>
<p><strong><em>Se divide el conjunto de datos en conjuntos de entrenamiento y prueba.</em></strong></p>
<p><strong><em>Se entrena el modelo Naive Bayes utilizando el conjunto de entrenamiento (dat.train) y se realiza la predicción en el conjunto de prueba (dat.test).</em></strong></p>
<p><strong><em>Se evalúa el rendimiento del modelo utilizando la matriz de confusión.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>datos[,<span class="dv">1</span><span class="sc">:</span>n1] <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">scale</span>(datos[,<span class="sc">-</span><span class="fu">ncol</span>(datos)]))</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(datos<span class="sc">$</span>Outcome) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"D"</span>,<span class="st">"N"</span>)</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(datos),<span class="at">size =</span> <span class="fu">nrow</span>(datos)<span class="sc">*</span><span class="fl">0.7</span>)</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>dat.train <span class="ot">&lt;-</span> datos[train,]</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>dat.test <span class="ot">&lt;-</span> datos[<span class="sc">-</span>train,]</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">naiveBayes</span>(Outcome <span class="sc">~</span> .,<span class="at">data=</span>dat.train,<span class="at">laplace =</span> <span class="dv">0</span>)</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>prediccion <span class="ot">&lt;-</span><span class="fu">predict</span>(mdl,dat.test[,<span class="sc">-</span><span class="fu">ncol</span>(dat.test)])</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(prediccion,dat.test<span class="sc">$</span>Outcome)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction  D  N
         D 61 13
         N 14 30
                                          
               Accuracy : 0.7712          
                 95% CI : (0.6848, 0.8435)
    No Information Rate : 0.6356          
    P-Value [Acc &gt; NIR] : 0.001116        
                                          
                  Kappa : 0.5085          
                                          
 Mcnemar's Test P-Value : 1.000000        
                                          
            Sensitivity : 0.8133          
            Specificity : 0.6977          
         Pos Pred Value : 0.8243          
         Neg Pred Value : 0.6818          
             Prevalence : 0.6356          
         Detection Rate : 0.5169          
   Detection Prevalence : 0.6271          
      Balanced Accuracy : 0.7555          
                                          
       'Positive' Class : D               
                                          </code></pre>
</div>
</div>
<p><strong><em>En este código se busca el valor de lambda más cercano al mejor valor de lambda seleccionado por el modelo LASSO.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>lambda_use <span class="ot">&lt;-</span> <span class="fu">min</span>(model<span class="sc">$</span>finalModel<span class="sc">$</span>lambda[model<span class="sc">$</span>finalModel<span class="sc">$</span>lambda <span class="sc">&gt;=</span> model<span class="sc">$</span>bestTune<span class="sc">$</span>lambda])</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>position <span class="ot">&lt;-</span> <span class="fu">which</span>(model<span class="sc">$</span>finalModel<span class="sc">$</span>lambda <span class="sc">==</span> lambda_use)</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>featsele <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">coef</span>(model<span class="sc">$</span>finalModel)[, position])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong><em>La función rownames() para obtener los nombres de las variables seleccionadas por el modelo LASSO</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(featsele)[featsele<span class="sc">$</span>coef.model.finalModel....position.<span class="sc">!=</span><span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "(Intercept)"              "Glucose"                 
[3] "BloodPressure"            "SkinThickness"           
[5] "BMI"                      "DiabetesPedigreeFunction"
[7] "Age"                     </code></pre>
</div>
</div>
<ul>
<li><p><strong><em>La función naiveBayes() se usa para ajustar el modelo Naive Bayes utilizando las variables seleccionadas.</em></strong></p></li>
<li><p><strong><em>La función predict() para realizar las predicciones en el conjunto de prueba dat.test[, -ncol(dat.test)], excluyendo la columna de la variable objetivo.</em></strong></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>mdl.sel <span class="ot">&lt;-</span><span class="fu">naiveBayes</span>(Outcome <span class="sc">~</span> Insulin<span class="sc">+</span>Glucose<span class="sc">+</span>DiabetesPedigreeFunction<span class="sc">+</span>Age,<span class="at">data =</span> dat.train)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>prediccion <span class="ot">&lt;-</span> <span class="fu">predict</span>(mdl.sel,dat.test[,<span class="sc">-</span><span class="fu">ncol</span>(dat.test)])</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(prediccion,dat.test<span class="sc">$</span>Outcome)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction  D  N
         D 61 14
         N 14 29
                                          
               Accuracy : 0.7627          
                 95% CI : (0.6756, 0.8362)
    No Information Rate : 0.6356          
    P-Value [Acc &gt; NIR] : 0.002176        
                                          
                  Kappa : 0.4878          
                                          
 Mcnemar's Test P-Value : 1.000000        
                                          
            Sensitivity : 0.8133          
            Specificity : 0.6744          
         Pos Pred Value : 0.8133          
         Neg Pred Value : 0.6744          
             Prevalence : 0.6356          
         Detection Rate : 0.5169          
   Detection Prevalence : 0.6356          
      Balanced Accuracy : 0.7439          
                                          
       'Positive' Class : D               
                                          </code></pre>
</div>
</div>
<p><strong><em>El método utilizado es “knn” y se especifica preProcess = c(“center”, “scale”) para centrar y escalar las variables predictoras.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">400</span>)</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>ctrl <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method=</span><span class="st">"repeatedcv"</span>,<span class="at">repeats =</span> <span class="dv">3</span>) <span class="co">#,classProbs=TRUE,summaryFunction = twoClassSummary)</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>knnFit <span class="ot">&lt;-</span> <span class="fu">train</span>(Outcome <span class="sc">~</span> ., <span class="at">data =</span> dat.train, <span class="at">method =</span> <span class="st">"knn"</span>, <span class="at">trControl =</span> ctrl, <span class="at">preProcess =</span> <span class="fu">c</span>(<span class="st">"center"</span>,<span class="st">"scale"</span>), <span class="at">tuneLength =</span> <span class="dv">50</span>)</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Output of kNN fit</span></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>knnFit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>k-Nearest Neighbors 

274 samples
  8 predictor
  2 classes: 'D', 'N' 

Pre-processing: centered (8), scaled (8) 
Resampling: Cross-Validated (10 fold, repeated 3 times) 
Summary of sample sizes: 247, 248, 246, 246, 248, 246, ... 
Resampling results across tuning parameters:

  k    Accuracy   Kappa    
    5  0.7599681  0.4157239
    7  0.7758445  0.4545957
    9  0.7744268  0.4462535
   11  0.7719577  0.4392666
   13  0.7742877  0.4333380
   15  0.7755189  0.4328764
   17  0.7815154  0.4469627
   19  0.7719475  0.4191027
   21  0.7696581  0.4173596
   23  0.7671415  0.4122724
   25  0.7684609  0.4145269
   27  0.7684168  0.4098484
   29  0.7732228  0.4227945
   31  0.7648012  0.3981665
   33  0.7686949  0.4019714
   35  0.7734093  0.4144352
   37  0.7710724  0.4059841
   39  0.7757462  0.4212040
   41  0.7769400  0.4234411
   43  0.7685626  0.3992834
   45  0.7710758  0.4052927
   47  0.7697938  0.4047324
   49  0.7723104  0.4104282
   51  0.7601377  0.3780455
   53  0.7576652  0.3710563
   55  0.7638414  0.3805935
   57  0.7612841  0.3724523
   59  0.7600020  0.3656696
   61  0.7610568  0.3668663
   63  0.7623389  0.3703532
   65  0.7686067  0.3809283
   67  0.7685151  0.3765588
   69  0.7648080  0.3626066
   71  0.7659985  0.3636048
   73  0.7597273  0.3415438
   75  0.7648996  0.3519634
   77  0.7648080  0.3511616
   79  0.7574854  0.3274641
   81  0.7538733  0.3141440
   83  0.7601004  0.3319476
   85  0.7563017  0.3236510
   87  0.7539174  0.3139696
   89  0.7478293  0.2911970
   91  0.7503460  0.2935031
   93  0.7467745  0.2817481
   95  0.7468661  0.2791814
   97  0.7384005  0.2502600
   99  0.7324040  0.2229326
  101  0.7348291  0.2316795
  103  0.7313017  0.2159920

Accuracy was used to select the optimal model using the largest value.
The final value used for the model was k = 17.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(knnFit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong><em>La función predict() para realizar las predicciones en el conjunto de prueba utilizando el modelo k-NN ajustado pasando como argumento el objeto knnFit y los datos de prueba.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>knnPredict <span class="ot">&lt;-</span> <span class="fu">predict</span>(knnFit,<span class="at">newdata =</span> dat.test[,<span class="sc">-</span><span class="fu">ncol</span>(dat.test)] )</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Get the confusion matrix to see accuracy value and other parameter values</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(knnPredict, dat.test<span class="sc">$</span>Outcome )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction  D  N
         D 65 18
         N 10 25
                                          
               Accuracy : 0.7627          
                 95% CI : (0.6756, 0.8362)
    No Information Rate : 0.6356          
    P-Value [Acc &gt; NIR] : 0.002176        
                                          
                  Kappa : 0.4666          
                                          
 Mcnemar's Test P-Value : 0.185877        
                                          
            Sensitivity : 0.8667          
            Specificity : 0.5814          
         Pos Pred Value : 0.7831          
         Neg Pred Value : 0.7143          
             Prevalence : 0.6356          
         Detection Rate : 0.5508          
   Detection Prevalence : 0.7034          
      Balanced Accuracy : 0.7240          
                                          
       'Positive' Class : D               
                                          </code></pre>
</div>
</div>
<p><strong><em>Ajuste del modelo PLS-DA utilizando la función train().</em></strong></p>
<p><strong><em>Lugo de ajustar el modelo PLS-DA, se realiza las predicciones en el conjunto de prueba utilizando la función predict() pasando como argumento el objeto plsda y los datos de prueba.</em></strong></p>
<p><strong><em>La función confusionMatrix() para calcular la matriz de confusión y obtener medidas de evaluación, como el área bajo la curva ROC.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./datos/diabetes.csv"</span>)</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>Outcome <span class="ot">&lt;-</span><span class="fu">as.factor</span>(datos<span class="sc">$</span>Outcome)</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>datos[,<span class="dv">1</span><span class="sc">:</span>n1] <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">scale</span>(datos[,<span class="sc">-</span><span class="fu">ncol</span>(datos)]))</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(datos<span class="sc">$</span>Outcome) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"D"</span>,<span class="st">"N"</span>)</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(datos),<span class="at">size =</span> <span class="fu">nrow</span>(datos)<span class="sc">*</span><span class="fl">0.7</span>)</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>dat.train <span class="ot">&lt;-</span> datos[train,]</span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>dat.test <span class="ot">&lt;-</span> datos[<span class="sc">-</span>train,]</span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1001</span>) </span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>ctrl<span class="ot">&lt;-</span><span class="fu">trainControl</span>(<span class="at">method=</span><span class="st">"repeatedcv"</span>,<span class="at">number=</span><span class="dv">10</span>,<span class="at">classProbs =</span> <span class="cn">TRUE</span>,<span class="at">summaryFunction =</span> twoClassSummary) </span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>plsda<span class="ot">&lt;-</span><span class="fu">train</span>(<span class="at">x=</span>dat.train[,<span class="sc">-</span><span class="fu">ncol</span>(datos)], <span class="co"># spectral data</span></span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">y=</span>dat.train<span class="sc">$</span>Outcome, <span class="co"># factor vector</span></span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">method=</span><span class="st">"pls"</span>, <span class="co"># pls-da algorithm</span></span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">tuneLength=</span><span class="dv">10</span>, <span class="co"># number of components</span></span>
<span id="cb117-16"><a href="#cb117-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">trControl=</span>ctrl, <span class="co"># ctrl contained cross-validation option</span></span>
<span id="cb117-17"><a href="#cb117-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">preProc=</span><span class="fu">c</span>(<span class="st">"center"</span>,<span class="st">"scale"</span>), <span class="co"># the data are centered and scaled</span></span>
<span id="cb117-18"><a href="#cb117-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">metric=</span><span class="st">"ROC"</span>) <span class="co"># metric is ROC for 2 classes</span></span>
<span id="cb117-19"><a href="#cb117-19" aria-hidden="true" tabindex="-1"></a>plsda</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Partial Least Squares 

537 samples
  8 predictor
  2 classes: 'D', 'N' 

Pre-processing: centered (8), scaled (8) 
Resampling: Cross-Validated (10 fold, repeated 1 times) 
Summary of sample sizes: 483, 484, 483, 483, 483, 483, ... 
Resampling results across tuning parameters:

  ncomp  ROC        Sens       Spec     
  1      0.8183485  0.8468067  0.5657895
  2      0.8348713  0.8667227  0.6181579
  3      0.8346068  0.8814286  0.6023684
  4      0.8342848  0.8756303  0.6076316
  5      0.8338425  0.8784874  0.6023684
  6      0.8336922  0.8784874  0.6023684
  7      0.8336922  0.8784874  0.6023684

ROC was used to select the optimal model using the largest value.
The final value used for the model was ncomp = 2.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>prediccion <span class="ot">&lt;-</span> <span class="fu">predict</span>(plsda,<span class="at">newdata =</span> dat.test[,<span class="sc">-</span><span class="fu">ncol</span>(datos)])</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(prediccion,dat.test<span class="sc">$</span>Outcome)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   D   N
         D 135  40
         N  19  37
                                          
               Accuracy : 0.7446          
                 95% CI : (0.6833, 0.7995)
    No Information Rate : 0.6667          
    P-Value [Acc &gt; NIR] : 0.006419        
                                          
                  Kappa : 0.3833          
                                          
 Mcnemar's Test P-Value : 0.009220        
                                          
            Sensitivity : 0.8766          
            Specificity : 0.4805          
         Pos Pred Value : 0.7714          
         Neg Pred Value : 0.6607          
             Prevalence : 0.6667          
         Detection Rate : 0.5844          
   Detection Prevalence : 0.7576          
      Balanced Accuracy : 0.6786          
                                          
       'Positive' Class : D               
                                          </code></pre>
</div>
</div>
<p>Si tuneamos lambda</p>
<p><strong><em>El resultado impreso será la precisión general del modelo Naive Bayes en el conjunto de prueba.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./datos/diabetes.csv"</span>)</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>Outcome <span class="ot">&lt;-</span><span class="fu">as.factor</span>(datos<span class="sc">$</span>Outcome)</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(datos<span class="sc">$</span>Outcome) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"D"</span>,<span class="st">"N"</span>)</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(datos),<span class="at">size =</span> <span class="fu">nrow</span>(datos)<span class="sc">*</span><span class="fl">0.7</span>)</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>dat.train <span class="ot">&lt;-</span> datos[train,]</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>dat.test <span class="ot">&lt;-</span> datos[<span class="sc">-</span>train,]</span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">50</span>,<span class="fl">0.1</span>)</span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a>  modelo <span class="ot">&lt;-</span> <span class="fu">naiveBayes</span>(dat.train[,<span class="sc">-</span><span class="fu">ncol</span>(datos)],dat.train<span class="sc">$</span>Outcome)</span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a>  predicciones <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo,dat.test[,<span class="sc">-</span><span class="fu">ncol</span>(datos)])</span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(predicciones,dat.test<span class="sc">$</span>Outcome)<span class="sc">$</span>overall[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Accuracy 
0.7705628 </code></pre>
</div>
</div>
<p><strong><em>Se carga el archivo “diabetes.csv” utilizando la función read.csv</em></strong></p>
<p><strong><em>Se convierte la variable Outcome en un factor utilizando as.factor.</em></strong></p>
<p><strong><em>Se estandarizan las variables predictoras en datos[,1:n1] utilizando scale para que tengan media cero y desviación estándar uno.</em></strong></p>
<p><strong><em>Se asignan los niveles “D” y “N”</em></strong></p>
<p><strong><em>Se divide el dataframe datos en dos conjuntos: dat.train y dat.test.</em></strong></p>
<p><strong><em>dat.train contendrá las filas correspondientes a los índices en train</em></strong></p>
<p><strong><em>test contendrá las filas restantes.</em></strong></p>
<p><strong><em>Se establece una semilla aleatoria (set.seed(1001)).</em></strong></p>
<p><strong><em>ctrl especifica los detalles del control del entrenamiento, se utiliza el método de validación cruzada repetida con 10 pliegues y se utiliza la métrica de resumen twoClassSummary.</em></strong></p>
<p><strong><em>Se entrena un modelo PLS-DA utilizando la función train.</em></strong></p>
<p><strong><em>Se especifican:</em></strong></p>
<ul>
<li><p><strong><em>x representa las variables predictoras (dat.train[,c(2,5,7,8)] selecciona las columnas 2, 5, 7 y 8 de dat.train)</em></strong></p></li>
<li><p><strong><em>y representa la variable de resultado (dat.train$Outcome)</em></strong></p></li>
<li><p><strong><em>metric establece la métrica de evaluación como el área bajo la curva ROC.</em></strong></p></li>
</ul>
<p><strong><em>La matriz de confusión compara las predicciones con las verdaderas etiquetas del conjunto de prueba (dat.test$Outcome).</em></strong></p>
<p><strong><em>La matriz de confusión, incluye la precisión, la sensibilidad, la especificidad.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./datos/diabetes.csv"</span>)</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>Outcome <span class="ot">&lt;-</span><span class="fu">as.factor</span>(datos<span class="sc">$</span>Outcome)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>datos[,<span class="dv">1</span><span class="sc">:</span>n1] <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">scale</span>(datos[,<span class="sc">-</span><span class="fu">ncol</span>(datos)]))</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(datos<span class="sc">$</span>Outcome) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"D"</span>,<span class="st">"N"</span>)</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(datos),<span class="at">size =</span> <span class="fu">nrow</span>(datos)<span class="sc">*</span><span class="fl">0.7</span>)</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>dat.train <span class="ot">&lt;-</span> datos[train,]</span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>dat.test <span class="ot">&lt;-</span> datos[<span class="sc">-</span>train,]</span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1001</span>) </span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a>ctrl<span class="ot">&lt;-</span><span class="fu">trainControl</span>(<span class="at">method=</span><span class="st">"repeatedcv"</span>,<span class="at">number=</span><span class="dv">10</span>,<span class="at">classProbs =</span> <span class="cn">TRUE</span>,<span class="at">summaryFunction =</span> twoClassSummary) </span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a>plsda<span class="ot">&lt;-</span><span class="fu">train</span>(<span class="at">x=</span>dat.train[,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">8</span>)], <span class="co"># spectral data</span></span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">y=</span>dat.train<span class="sc">$</span>Outcome, <span class="co"># factor vector</span></span>
<span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">method=</span><span class="st">"pls"</span>, <span class="co"># pls-da algorithm</span></span>
<span id="cb123-15"><a href="#cb123-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">tuneLength=</span><span class="dv">10</span>, <span class="co"># number of components</span></span>
<span id="cb123-16"><a href="#cb123-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">trControl=</span>ctrl, <span class="co"># ctrl contained cross-validation option</span></span>
<span id="cb123-17"><a href="#cb123-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">preProc=</span><span class="fu">c</span>(<span class="st">"center"</span>,<span class="st">"scale"</span>), <span class="co"># the data are centered and scaled</span></span>
<span id="cb123-18"><a href="#cb123-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">metric=</span><span class="st">"ROC"</span>) <span class="co"># metric is ROC for 2 classes</span></span>
<span id="cb123-19"><a href="#cb123-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-20"><a href="#cb123-20" aria-hidden="true" tabindex="-1"></a>prediccion <span class="ot">&lt;-</span> <span class="fu">predict</span>(plsda,dat.test[,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">8</span>)])</span>
<span id="cb123-21"><a href="#cb123-21" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(prediccion,dat.test<span class="sc">$</span>Outcome)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   D   N
         D 136  42
         N   9  44
                                         
               Accuracy : 0.7792         
                 95% CI : (0.7201, 0.831)
    No Information Rate : 0.6277         
    P-Value [Acc &gt; NIR] : 5.532e-07      
                                         
                  Kappa : 0.4876         
                                         
 Mcnemar's Test P-Value : 7.433e-06      
                                         
            Sensitivity : 0.9379         
            Specificity : 0.5116         
         Pos Pred Value : 0.7640         
         Neg Pred Value : 0.8302         
             Prevalence : 0.6277         
         Detection Rate : 0.5887         
   Detection Prevalence : 0.7706         
      Balanced Accuracy : 0.7248         
                                         
       'Positive' Class : D              
                                         </code></pre>
</div>
</div>
<p>Finalmente podríamos hacer un análisis de la varianza multivariante.</p>
<p><strong><em>La función adonis2 realiza un análisis de varianza multivariado (PERMANOVA) utilizando la disimilaridad definida por la distancia euclidiana.</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vegan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: permute</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>This is vegan 2.6-4</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'vegan'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:caret':

    tolerance</code></pre>
</div>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adonis2</span>(datos[,<span class="sc">-</span><span class="fu">ncol</span>(datos)] <span class="sc">~</span>datos<span class="sc">$</span>Outcome,<span class="at">method =</span> <span class="st">"euclidean"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for adonis under reduced model
Terms added sequentially (first to last)
Permutation: free
Number of permutations: 999

adonis2(formula = datos[, -ncol(datos)] ~ datos$Outcome, method = "euclidean")
               Df SumOfSqs      R2      F Pr(&gt;F)    
datos$Outcome   1    357.8 0.05831 47.434  0.001 ***
Residual      766   5778.2 0.94169                  
Total         767   6136.0 1.00000                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Es decir, como conlusión aunque las variables no pueden detectar la diabetes, siendo variables independientes, si por otro lado las consideramos dependientes de la diabetes.</p>
<p>Es decir, la diabetes es una condición en la que influye en los parámetros, mientras que es menos probable que la diabetes sea la causa de estas alteraciones, con una mejor precisón del 77 por ciento.</p>
<p>Es decir, por un lado tenemos las variables que nos explican solo un 77 porciento de la diabetes, mientras que la condición en sí nos separa más entre la media global.</p>
<p>Se podría investigar más esto. Por ejemplo, se podría hacer una correlación parcial, dada la diabetes, e identificar aquellas variables especificamente relacionadas con esta.</p>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
<p><strong>Curva ROC</strong></p>
<p>Se utilizará la biblioteca pROC para ello instalarla con el siguiente código:</p>
<p><code>(install.packages("pROC"))</code></p>
<p>La curva ROC representa:</p>
<ul>
<li><p>La relación entre la tasa de verdaderos positivos (sensibilidad)</p></li>
<li><p>La tasa de falsos positivos (1-especificidad) a medida que se varía el umbral de clasificación.</p></li>
</ul>
<p><strong><em>Pasos:</em></strong></p>
<ol type="1">
<li><p>Ajustar el modelo de Regresión Logística</p></li>
<li><p>Obtener las probabilidades predichas para el conjunto de prueba</p></li>
<li><p>Crear la curva ROC</p></li>
<li><p>Graficar la curva ROC</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Type 'citation("pROC")' for a citation.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'pROC'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    cov, smooth, var</code></pre>
</div>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Regresión Logística</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>glm.mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(Outcome <span class="sc">~</span> ., <span class="at">data =</span> dat.train, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Probabilidades </span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>pred.prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm.mod, dat.test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear </span></span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(dat.test<span class="sc">$</span>Outcome, pred.prob)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = D, case = N</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Graficar </span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_obj, <span class="at">main =</span> <span class="st">"Curva ROC"</span>, <span class="at">xlab =</span> <span class="st">"Tasa de Falsos Positivos"</span>, <span class="at">ylab =</span> <span class="st">"Tasa de Verdaderos Positivos"</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="repaso_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>